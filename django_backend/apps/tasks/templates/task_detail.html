<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Task Detail</title>
<style>
body { font-family: Arial; background-color: #f5f5f5; padding: 20px; }
.form-container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); }
h2 { text-align: center; }
.form-group { margin-bottom: 15px; }
label { display: block; margin-bottom: 5px; }
input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; background-color: #eee; border: 1px solid #ccc; }
input:disabled, select:disabled, textarea:disabled { background-color: #f0f0f0; }
button { display: block; width: 100%; padding: 10px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
button:hover { background-color: #2980b9; }
</style>
</head>
<body>
<div class="form-container">
<h2>Task Detail</h2>

<form id="taskDetailForm">
    <div class="form-group">
        <label for="id_title">Title</label>
        <input type="text" id="id_title" disabled>
    </div>
    <div class="form-group">
        <label for="id_description">Description</label>
        <textarea id="id_description" rows="4" disabled></textarea>
    </div>
    <div class="form-group">
        <label for="id_status">Status</label>
        <select id="id_status" disabled>
            <option value="todo">To Do</option>
            <option value="in_progress">In Progress</option>
            <option value="done">Done</option>
        </select>
    </div>
    <div class="form-group">
        <label for="id_priority">Priority</label>
        <select id="id_priority" disabled>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
        </select>
    </div>
    <div class="form-group">
        <label for="id_due_date">Due Date</label>
        <input type="datetime-local" id="id_due_date" disabled>
    </div>
    <div class="form-group">
        <label for="id_estimated_hours">Estimated Hours</label>
        <input type="number" id="id_estimated_hours" step="0.1" disabled>
    </div>
    <button type="button" onclick="window.history.back();">Back</button>
</form>
</div>

<script>
const accessToken = localStorage.getItem('access_token');
if (!accessToken) window.location.href = '/login/';

const taskId = '{{ task_id }}'; // Injectado por Django

fetch(`http://localhost:8000/api/tasks/${taskId}/`, {
    method: 'GET',
    headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
    }
})
.then(res => {
    if(res.status === 401) {
        localStorage.removeItem('access_token');
        window.location.href = '/login/';
    }
    return res.json();
})
.then(task => {
    document.getElementById('id_title').value = task.title;
    document.getElementById('id_description').value = task.description;
    document.getElementById('id_status').value = task.status;
    document.getElementById('id_priority').value = task.priority;
    document.getElementById('id_due_date').value = new Date(task.due_date).toISOString().slice(0,16);
    document.getElementById('id_estimated_hours').value = task.estimated_hours || 0;
})
.catch(err => {
    console.error(err);
    alert("Failed to load task details.");
});
</script>
</body>
</html>

